@import compass/css3.sass
@import fancy_gradient.sass

!default_button_font_size ||= 18px
!default_button_color ||= #444
!default_button_font_weight ||= "bold"
!default_button_border_width ||= 1px
!default_button_radius ||= 6px
!default_button_light_text ||= #fff
!default_button_dark_text ||= #222

// Make a fancy button.
=fancy-button(!color= !default_button_color, !font_size= !default_button_font_size, !radius= !default_button_radius, !border_width= !default_button_border_width)
  +fancy-button-structure(!font_size, !radius, !border_width)
  +fancy-button-colors(!color)

// Style the button's colors, picking the most appropriate color set for the base color.
=fancy-button-colors(!color = !default_button_color, !hover = 0, !active = 0)
  +fb-color(!color)
  &:hover, &:focus
    @if !hover == 0
      +fb-color(darken(!color, 3), !color)
    @else
      +fb-color(!hover)
  &:active
    @if !active == 0
      +fb-color(darken(!color, 6), !color)
    @else
      +fb-color(!active)

// Default state color settings
=fb-color(!color, !lumins = !color)
  !gradient_top = lighten(!color, 15)
  !gradient_bottom = darken(!color, 06)
  !border_color = darken(!color, 08)
  @if saturation(!color) > 0
    !color = saturate(!color, 40)
  +fb-state-colors(!color, !gradient_top, !gradient_bottom, !border_color, !lumins)

// Apply the button colors specified for the button state into which it is mixed.
=fb-state-colors(!color, !gradient_top, !gradient_bottom, !border, !lumins = !color)
  background-color= !color
  +fancy-gradient(!gradient_top, !gradient_bottom)
  border:
    color= !border
  @if luminosity(!lumins) < luminosity(#aaa)
    text-shadow= darken(!color, 25) "1px 1px 1px"
    color= !default_button_light_text
  @else
    text-shadow= lighten(!color, 15) "1px 1px 1px"
    color= !default_button_dark_text

=fb-text-color(!text, !bg, !force_color = 0)
  @if !override
    color= !override
    text-shadow= darken(!bg, 10) "1px 1px 1px"
  @else
    color= !color
    text-shadow= darken(!bg, 10) "1px 1px 1px"
  
// Apply this mixin to a nested element to style an arrow
=fancy-arrow(!font_size)
  font-size= !font_size + 4px
  line-height= !font_size - 4px
  margin-left= 4px

// Layout the button's box
=fancy-button-structure(!font_size = !default_button_font_size, !radius = !default_button_radius, !border_width = !default_button_border_width, !line_height = !font_size * 1.2)
  +fb-reset
  +fancy-button-size(!font_size, !radius, !border_width, !line_height)

=fancy-button-size(!font_size = !default_button_font_size, !radius = !default_button_radius, !border_width = !default_button_border_width, !line_height = !font_size * 1.2)
  // better padding for smaller buttons
  !v_padding = 0
  !h_padding = 0
  @if !font_size > 15
    !v_padding = floor(!font_size/3.5)
    !h_padding = !font_size
  @else
    !v_padding = floor(!font_size/5)
    !h_padding = floor(!font_size/1.2)
  
  !v_padding_active = !v_padding - 1px
  !h_padding_active = !h_padding - 1px
  @if !radius > 0
    +border-radius(!radius)
  padding= !v_padding !h_padding
  font-size= !font_size
  line-height= !line_height
  border-width= !border_width
  &:active
    padding= !v_padding_active !h_padding_active
    border-width= !border_width + 1px
  &.disabled:active
    padding= !v_padding !h_padding
    border-width= !border_width

// Reset the button's important properties to make sure they behave correctly
=fb-reset(!font_weight = !default_button_font_weight)
  font-family: "Lucida Grande", Lucida, Arial, sans_serif
  background: #{image_url("button_bg.png")} repeat-x bottom left
  margin: 0
  width: auto
  overflow: visible
  display: inline-block
  cursor: pointer
  text-decoration: none
  border-style: solid
  font-weight= !font_weight
  &::-moz-focus-inner
    border: none
    padding: 0
  &:focus
    outline: none

=disable-button(!opacity = .7)
  +opacity(!opacity)
  &:hover
    cursor: default